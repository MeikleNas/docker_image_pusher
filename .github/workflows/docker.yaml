name: 清理磁盘空间

on:
  workflow_dispatch:  # 仅保留手动触发，避免自动执行干扰业务

jobs:
  clean-disk:
    runs-on: ubuntu-latest  # 自托管Runner替换为你的标签（如self-hosted）
    steps:
      - name: 执行磁盘清理
        run: |
          # 清理系统日志（释放核心空间）
          sudo journalctl --vacuum-size=100M
          sudo rm -rf /var/log/*.gz
          sudo truncate -s 0 /var/log/syslog /var/log/auth.log 2>/dev/null
          
          # 清理GitHub Runner缓存（重点）
          sudo rm -rf /home/runner/actions-runner/_work/_temp/* 2>/dev/null
          sudo rm -rf /home/runner/actions-runner/_work/_artifact/* 2>/dev/null
          sudo rm -rf /home/runner/.cache/* 2>/dev/null
          
          # 清理系统临时文件
          sudo rm -rf /tmp/* 2>/dev/null
          sudo rm -rf /var/tmp/* 2>/dev/null
          
          # 清理Docker无用资源
          sudo docker system prune -af
          
          # 输出清理后空间状态（验证效果）
          echo "===== 清理完成，当前根分区空间 ====="
          df -h /
